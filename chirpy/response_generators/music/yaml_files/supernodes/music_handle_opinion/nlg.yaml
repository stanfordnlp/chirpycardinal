sname: music_handle_opinion

requirements:
  - state.entering_music_rg: True

# TODO: Here
prompt_ranking: 2 # ranking relative to other supernodes' unconditional prompt
unconditional_prompt_updates:
  contextual_prompt:
    prompt_type: PromptType.CONTEXTUAL
    start_discussing_music: True
    have_prompted: True

# define the convo-path relevant state updates made by each subnode
# each subnode MUST define a prompt_treelet
prompt:
  # multiple matching prompts will be returned uniformly at random
  - required: None
    prompt: 'Do you like music too?'
  - required: None
    prompt: 'Do you listen to music often?'

unconditional_prompt:
  - case_name: contextual_prompt
    entry_conditions:
      'have_prompted': False
      'user_mentioned_music_positive': True
    prompt: "{get_likes_music_response()}"

# TODO: Til here

global_post_supernode_updates:
  state.entering_music_rg: False

response:
  - response_node_name: listens_frequently
    response_entry_conditions:
      response_flags.listens_frequently: True
    response: Well for me, I love listening to music everyday!
    local_post_subnode_updates:
      answer_type: AnswerType.QUESTION_SELFHANDLING
      state.start_discussing_music: True

  - response_node_name: listens_everday
    response_entry_conditions:
      response_flags.listens_everday: True
    response: Well for me, I love listening to music everyday too!
    local_post_subnode_updates:
      answer_type: AnswerType.QUESTION_SELFHANDLING
      state.start_discussing_music: True

  - response_node_name: does_not_listen
    response_entry_conditions:
      response_flags.does_not_listen: True
    response: No problem! Everyone has different interests and it sounds like music isn't your thing.
    local_post_subnode_updates:
      answer_type: AnswerType.NONE
      state.exit_music_rg: True

  - response_node_name: unsure_about_music
    response_entry_conditions:
      response_flags.unsure_about_music: True
    response: It's okay, sometimes I am not sure how I feel about music either. But in some ways, music is tremendously fascinating. A physical dancing of air molecules that translates to figurative dancing of neurons. But philosophical musings aside,
    local_post_subnode_updates:
      answer_type: AnswerType.QUESTION_SELFHANDLING
      state.start_discussing_music: True

  - response_node_name: likes_music
    response_entry_conditions:
      likes_music: True
    response: # '{get_likes_music_response()}'
      - nlg_helper: # TODO: Check if can decompose more
          name: get_likes_music_response
    local_post_subnode_updates:
      answer_type: AnswerType.QUESTION_SELFHANDLING
      state.start_discussing_music: True

  - response_node_name: catch_all
    response_entry_conditions:
      response_flags.catch_all: True
    response: Okay, sure!
    local_post_subnode_updates:
      state.exit_music_rg: True




